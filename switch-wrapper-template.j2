{#
# Generate wrapper lights that proxy switches
#}
light:
{%for s in states.switch -%}
{%if true %}
  - platform: template
    lights:
      {{ s.entity_id|replace('.', "_") }}:
        friendly_name: {{s.attributes.friendly_name}}
        level_template: '{{ '{{' }} 255 if is_state("{{ s.entity_id }}", "on") else 0 }}'
        value_template: '{{ '{{' }} is_state("{{ s.entity_id }}", "on") }}'
        turn_on:
          service: switch.turn_on
          entity_id: {{ s.entity_id }}
        turn_off:
          service: switch.turn_off
          entity_id: {{ s.entity_id }}
        set_level:
          service_template: switch.turn_'{{ '{{' }} "off" if brightness == 0 else "on" }}'
          entity_id: {{ s.entity_id }}
{% endif -%}
{% endfor %}